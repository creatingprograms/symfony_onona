<?
  if (
    (
      sfContext::getInstance()->getRouting()->getCurrentRouteName() == "category_show" or
      // sfContext::getInstance()->getRouting()->getCurrentRouteName() == "category_show" or
      sfContext::getInstance()->getRouting()->getCurrentRouteName() == "category_show_page"
    )
    and $sf_request->getParameter('slug') != "skidki-do-99"
    and $sf_request->getParameter('slug') != "Luchshaya_tsena"
    and $sf_request->getParameter('slug') != "vesennee-specpredlozhenie"
    and $sf_request->getParameter('slug') != "podarki"
    and $sf_request->getParameter('slug') != "upravlyai-cenoi"
  ){ ?>
    <script>
      function changeFilterTab(){
        if ($('#filters').css('display') == 'none') {
            $('.descriptionCategory').fadeOut(300);
            // $('#filterSlider').html('<u style=\'color:#04590e\'>Меню</u> / Фильтры');
            $('.filter-element--menu').removeClass('active');
            $('.filter-element--filter').addClass('active');
            $('#filters').css('display', 'block');
            $('ul.cat-menu').css('display', 'none');
            $('#buttonFilter span').html('Главное меню <img src=\'/images/filters/silver-str-right.png\'  style=\'position: relative; top: 2px;\' alt=\'silverbutton\'  />');
            // $('#buttonFilter').removeClass('filtersButton').addClass('categoryButton');
        } else {
            // $('#filterSlider').html('Меню / <u style=\'color:#04590e\'>Фильтры</u>');
            $('.filter-element--menu').addClass('active');
            $('.filter-element--filter').removeClass('active');
            $('#filters').css('display', 'none');
            $('ul.cat-menu').css('display', 'block');
            $('#buttonFilter span').html('Фильтры товаров <img src=\'/images/filters/green-str-right.png\'  style=\'position: relative; top: 2px;\' alt=\'greenbutton\'  />');
            // $('#buttonFilter').removeClass('categoryButton').addClass('filtersButton');

            $('span.clearparams').each(function (i, elem) {
                $(elem).click();
            });
        }
      }
    </script>
    <div class="category-filter" id="filterSlider" onClick="changeFilterTab();">
      <div class="filter-element filter-element--menu<?= !count($_GET['filters']) ? ' active' : ''?>">Меню</div>
      <div class="filter-element filter-element--filter<?= count($_GET['filters']) ? ' active' : ''?>">Фильтры</div>
      <?/* if (count($_GET['filters']) > 0) { ?>
        <u style='color:#04590e'>Меню</u> / Фильтры
      <? }
      else { ?>
        Меню / <u style='color:#04590e'>Фильтры</u><?php } */?>
    </div>
    <?/*
      <div class="<? if (count($_GET['filters']) > 0) { ?>categoryButton<? } else { ?>filtersButton<?php } ?>" style="position: absolute; right: 240px; top: 25px;" id="buttonFilter" onClick="
                if ($('#filters').css('display') == 'none') {
                    $('#filterSlider').html('<u style=\'color:#04590e\'>Меню</u> / Фильтры');
                    $('#filters').css('display', 'block');
                    $('ul.cat-menu').css('display', 'none');
                    $('#buttonFilter span').html('Главное меню <img src=\'/images/filters/silver-str-right.png\'  style=\'position: relative; top: 2px;\' alt=\'silverbutton\' />');
                    $('#buttonFilter').removeClass('filtersButton').addClass('categoryButton');
                } else {
                    $('#filterSlider').html('Меню / <u style=\'color:#04590e\'>Фильтры</u>');
                    $('#filters').css('display', 'none');
                    $('ul.cat-menu').css('display', 'block');
                    $('#buttonFilter span').html('Фильтры товаров <img src=\'/images/filters/green-str-right.png\'  style=\'position: relative; top: 2px;\' alt=\'greenbutton\' />');
                    $('#buttonFilter').removeClass('categoryButton').addClass('filtersButton');

                    $('span.clearparams').each(function (i, elem) {
                        $(elem).click();
                    });
                }
         "></div>
         */?>
<? } ?>
<ul class="cat-menu" <? If (count($_GET['filters']) > 0) { ?> style="display:none;"<?php } ?>><?
    /* // Считываем текущее время
      $current_time = microtime();
      // Отделяем секунды от миллисекунд
      $current_time = explode(" ", $current_time);
      // Складываем секунды и миллисекунды
      $start_time = $current_time[1] + $current_time[0]; */
    slot('category_slug', $slot);
    //get_slot('category_slug')
    //SELECT catalog.*,category.* FROM `catalog` left join category_catalog on category_catalog.catalog_id=catalog.id left join category on category_catalog.category_id=category.id where catalog.is_public='1' and category.is_public='1' order by catalog.position ASC ,category.position ASC
    //SELECT catalog.id as catid,catalog.name as catname,catalog.img as catimg,catalog.description as catdescription,catalog.slug as catslug,category.*,categoryChild.*,c.id AS c__id, c.name AS c__name, c.content AS c__content, c.is_open AS c__is_open, c.is_public AS c__is_public, c.adult AS c__adult, c.title AS c__title, c.keywords AS c__keywords, c.description AS c__description, c.parents_id AS c__parents_id, c.lovepricename AS c__lovepricename, c.positionloveprice AS c__positionloveprice, c.filters AS c__filters, c.tags AS c__tags, c.created_at AS c__created_at, c.updated_at AS c__updated_at, c.position AS c__position, c.slug AS c__slug  FROM `catalog` left join category_catalog on category_catalog.catalog_id=catalog.id left join category on category_catalog.category_id=category.id left join category as categoryChild on category.id=categoryChild.parents_id where catalog.is_public='1' and category.is_public='1' order by catalog.position ASC ,category.position ASC
    //SELECT catalog.id as catid,catalog.name as catname,catalog.img as catimg,catalog.description as catdescription,catalog.slug as catslug,category.*,categoryChild.id AS c__id, categoryChild.name AS c__name, categoryChild.parents_id AS c__parents_id, categoryChild.slug AS c__slug  FROM `catalog` left join category_catalog on category_catalog.catalog_id=catalog.id left join category on category_catalog.category_id=category.id left join category as categoryChild on category.id=categoryChild.parents_id where catalog.is_public='1' and category.is_public='1' and categoryChild.is_public='1' order by catalog.position ASC ,category.position ASC
    $q = Doctrine_Manager::getInstance()->getCurrentConnection();
    $result = $q->execute("SELECT catalog.id as catid,catalog.name as catname,catalog.img as catimg,catalog.description as catdescription,catalog.slug as catslug,category.*,categoryChild.id AS c__id, categoryChild.name AS c__name, categoryChild.parents_id AS c__parents_id, categoryChild.slug AS c__slug  FROM `catalog` left join category_catalog on category_catalog.catalog_id=catalog.id left join category on category_catalog.category_id=category.id left join category as categoryChild on category.id=categoryChild.parents_id and categoryChild.is_public='1' where catalog.is_public='1' and category.is_public='1' and (categoryChild.is_public!='0' or categoryChild.is_public is null) order by catalog.position ASC ,category.position ASC");

    $result->setFetchMode(Doctrine_Core::FETCH_ASSOC);
    $categorys = $result->fetchAll();

    if (get_slot('category_slug') != "") {
        $slugCategory = get_slot('category_slug');
    } else {
        $slugCategory = $sf_request->getParameter('slug');
    }

    $q = Doctrine_Manager::getInstance()->getCurrentConnection();
    $selectCategory = $q->execute("SELECT catalog.id AS catid, catalog.name AS catname, catalog.img AS catimg, catalog.description AS catdescription, catalog.slug AS catslug, category . * , categoryChild.id AS c__id, categoryChild.name AS c__name, categoryChild.parents_id AS c__parents_id, categoryChild.slug AS c__slug
FROM  `catalog`
LEFT JOIN category_catalog ON category_catalog.catalog_id = catalog.id
LEFT JOIN category ON category_catalog.category_id = category.id
LEFT JOIN category AS categoryChild ON category.id = categoryChild.parents_id
WHERE catalog.slug = ?
OR category.slug = ?
OR categoryChild.slug  = ?
OR catalog.id  = ?
OR category.id  = ?
OR categoryChild.id  = ? ", array($slugCategory, $slugCategory, $slugCategory, $slugCategory, $slugCategory, $slugCategory))->fetchAll(Doctrine_Core::FETCH_ASSOC);
    $categoryArray = array();
    $CatalogWork = "";
    $CategoryWork = "";
    $parentIdRam = "";
    foreach ($categorys as $keyCategory => $category) :
        /* $categoryArray[$category['catid']]['catdescription']=$category['catdescription'];
          $categoryArray[$category['catid']]['catimg']=$category['catimg'];
          $categoryArray[$category['catid']]['category'][$category['id']]= */
        if ($CatalogWork != $category['catname']) :
            $CatalogWork = $category['catname'];
            //print_r($categorys);
            ?>
            <li<? if ($category['catslug'] == $selectCategory[0]['catslug']) echo ' class="active"'; ?>><a id="catalog_<?= $category['catid'] ?>" href="<?= '/catalog/' . $category['catslug'] ?>"
                                                                                                           onClick="location.replace('<?= '/catalog/' . $category['catslug'] ?>')">

                    <span class="arrow"></span>
                    <span class="text">
                        <strong><?= $category['catname'] ?></strong>
                        <em><?= $category['catdescription'] ?></em>
                    </span><span class="img-holder">
                        <img width="90" height="118" alt="image description" src="/uploads/photo/<?= $category['catimg'] ?>">
                    </span>
                    <span class="deco-left"></span>
                    <span class="deco-right"></span>
                </a>
                <ul <?
                if ($category['catslug'] == $selectCategory[0]['catslug']) {
                    echo "class=\"drop\"  style=\"display: block;\"";
                } else {
                    echo "class=\"dropLeft drop\"";
                }
                ?>>
                        <?
                    endif;
                    ?>
                    <?
                    if ($CategoryWork != $category['name']) :
                        $CategoryWork = $category['name'];
                        ?><li<? if ($category['slug'] == $selectCategory[0]['slug'] and sfContext::getInstance()->getRouting()->getCurrentRouteName() != "catalog_show_newprod" and sfContext::getInstance()->getRouting()->getCurrentRouteName() != "catalog_show_relatecategory" and sfContext::getInstance()->getRouting()->getCurrentRouteName() != "catalog_show") echo ' class="active"'; ?>>

                        <a href="<?= '/category/' . $category['slug'] ?>"><?= $category['name'] ?></a>
                    <? endif; ?>
                    <?
                    //print_r($category);
                    if ($parentIdRam != $category['c__parents_id'] and $category['c__parents_id'] != 0) {
                        $parentIdRam = $category['c__parents_id'];
                        ?><ul<? if ($category['slug'] == $selectCategory[0]['slug'] and sfContext::getInstance()->getRouting()->getCurrentRouteName() != "catalog_show_newprod" and sfContext::getInstance()->getRouting()->getCurrentRouteName() != "catalog_show_relatecategory" and sfContext::getInstance()->getRouting()->getCurrentRouteName() != "catalog_show") echo ' style="display: block;"'; ?>><? } ?>
                        <? If ($category['c__parents_id'] != 0) { ?>

                            <li<? if ($category['c__slug'] == $slugCategory) echo ' class="active"'; ?>><a href="<?= '/category/' . $category['c__slug'] ?>"> <?= $category['c__name'] ?></a></li><? } ?>

                        <? if (@$parentIdRam != @$categorys[$keyCategory + 1]['c__parents_id'] and $category['c__parents_id'] != 0) {
                            ?></ul></li><?
                }
                if (@$CatalogWork != @$categorys[$keyCategory + 1]['catname']) :
                    ?><li<?
                            if ($category['catslug'] == $sf_request->getParameter('slug') and sfContext::getInstance()->getRouting()->getCurrentRouteName() == "catalog_show_newprod") {
                                echo "  class=\"active\"";
                            }
                            ?>><a href="<?= '/catalog/' . $category['catslug'] . "/newprod" ?>" class="newrel">Новые товары</a></li>
                    <li<?
                    if ($category['catslug'] == $sf_request->getParameter('slug') and sfContext::getInstance()->getRouting()->getCurrentRouteName() == "catalog_show_relatecategory") {
                        echo "  class=\"active\"";
                    }
                    ?>><a href="<?= '/catalog/' . $category['catslug'] . "/relatecategory" ?>" class="newrel">Лидеры продаж</a></li>
                        <?
                        echo "</ul></li>";
                    endif;


                endforeach;
                ?></ul>

        <?
        if ($this->getModuleName() == "category" and ( sfContext::getInstance()->getRouting()->getCurrentRouteName() == "category_show" or sfContext::getInstance()->getRouting()->getCurrentRouteName() == "category_show" or sfContext::getInstance()->getRouting()->getCurrentRouteName() == "category_show_page" )) {

            $filtersDB = unserialize(get_slot('filtersCategory')['filters']);
            $filters = unserialize(get_slot("filtersParams"));
            $price = unserialize(get_slot("filtersPrice"));
            $page = unserialize(get_slot("filtersPage"));
            $sortOrder = unserialize(get_slot("filtersSortOrder"));
            $direction = unserialize(get_slot("filtersDirection"));
            $filtersCountProducts = unserialize(get_slot("filtersCountProducts"));
            $isStock = unserialize(get_slot("filtersIsStock"));
            ?>

            <script src="/js/jquery.ui-slider.js"></script>
            <script>

               $(document).ready(function () {
                   $("#categoryFilters").ajaxForm(function (result) {
                       var queryString = $('#categoryFilters').formSerialize();
                       var redirect = '<?= explode("?", $_SERVER['REQUEST_URI'])[0] ?>?' + queryString;
                       history.pushState('', '', redirect);

                       $("#content").html(result);

                       $("#content").find("img.thumbnails").each(function () {
                           $(this).attr("src", $(this).attr("data-original"));
                       });
                       initPopup();
                       viravnivanie();
                       /*$("div.c div.notcount").hover(function () {
                           $(this).stop().animate({"opacity": 1});
                       }, function () {
                           $(this).stop().animate({"opacity": 0.3});
                       });*/


                       if ($("div").is("#filtersCountProducts")) {
                           $filtersCountProducts = JSON.parse($("#filtersCountProducts").html());
                           $("input.filteParams").each(function (index) {
                               if ($filtersCountProducts[$(this).val()] !== undefined) {
                                   $(this).parent().find("div.countProd").html($filtersCountProducts[$(this).val()]["count"]);
                               } else {
                                   $(this).parent().find("div.countProd").html(0);
                               }
                           });
                       } else {
                           $("input.filteParams").each(function (index) {
                               $(this).parent().find("div.countProd").html($(this).parent().find("div.countProd").data("default"));

                           });
                       }
                   });
               });
            </script>


            <div id="filters" <? If (count($_GET['filters']) == 0) { ?> style="display:none;"<?php } ?>>
                <form action="" id="categoryFilters" method="POST">
                    <input type="hidden" name="page" value="<?= $page ?>" id="pageFromFilter">
                    <input type="hidden" name="loadProducts" value="0" id="pageFromFilter">
                    <input type="hidden" name="sortOrder" value="<?= $sortOrder ?>" id="sortOrderFilter">
                    <input type="hidden" name="direction" value="<?= $direction ?>" id="directionFilter">
                    <input type="hidden" name="isStock" value="<?= $isStock ?>" id="isStockFilter">
                    <ul class="list filtersLi" style="list-style: none;padding: 0;">
                        <li>
                            <div class="paramFilter">
                                <div class="headerFilter" onclick="$('#paramsPrice').toggle();
                                            if ($(this).children('img.imgButtonToggle').attr('src') == '/images/filters/silver-str-bottom.png') {
                                                $(this).children('img.imgButtonToggle').attr('src', '/images/filters/red-str-right.png');
                                            } else {
                                                $(this).children('img.imgButtonToggle').attr('src', '/images/filters/silver-str-bottom.png');
                                            }">Цена<img src="/images/filters/silver-str-bottom.png" class="imgButtonToggle" style="position: absolute; right: 10px; top: 10px;" alt="silverbutton"></div>
                                <div class="value" id="paramsPrice">
                                    от <input type="text" class="textParam" id="minCostPrice" value="<?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>" name="Price[from]" data-value="<?= get_slot('filtersCategory')['minPrice'] ?>" />
                                    до <input type="text" class="textParam" id="maxCostPrice" value="<?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>" name="Price[to]" data-value="<?= get_slot('filtersCategory')['maxPrice'] ?>" /> <span style="font-family: 'PT Sans Narrow', sans-serif;">₽</span>

                                    <div id="sliderPrice" class="filter-slider"></div>
                                    <script type="text/javascript">
                                        jQuery("#sliderPrice").slider({
                                            min: <?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>,
                                            animate: true,
                                            max: <?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>,
                                            step: 0.1,
                                            values: [<?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>, <?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>],
                                            range: true,
                                            stop: function (event, ui) {
                                                jQuery("input#minCostPrice").val(jQuery("#sliderPrice").slider("values", 0));
                                                jQuery("input#maxCostPrice").val(jQuery("#sliderPrice").slider("values", 1));
                                                if (parseFloat(jQuery("input#minCostPrice").val()) == parseFloat(<?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>) && parseFloat(jQuery("input#maxCostPrice").val()) == parseFloat(<?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>)) {
                                                    jQuery("input#rangeChangePrice").val(0);
                                                } else {
                                                    jQuery("input#rangeChangePrice").val(1);
                                                }
                                                jQuery("#categoryFilters").submit();
                                            },
                                            slide: function (event, ui) {
                                                jQuery("input#minCostPrice").val(jQuery("#sliderPrice").slider("values", 0));
                                                jQuery("input#maxCostPrice").val(jQuery("#sliderPrice").slider("values", 1));
                                                if (parseFloat(jQuery("input#minCostPrice").val()) == parseFloat(<?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>) && parseFloat(jQuery("input#maxCostPrice").val()) == parseFloat(<?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>)) {
                                                    jQuery("input#rangeChangePrice").val(0);
                                                } else {
                                                    jQuery("input#rangeChangePrice").val(1);
                                                }

                                            }

                                        });
                                        jQuery("input#minCostPrice").change(function () {
                                            var value1 = jQuery("input#minCostPrice").val();
                                            var value2 = jQuery("input#maxCostPrice").val();

                                            if (parseFloat(value1) > parseFloat(value2)) {
                                                value1 = value2;
                                                jQuery("input#minCostPrice").val(value1);
                                            }
                                            if (parseFloat(value1) < parseFloat(<?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>)) {
                                                value1 = <?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>;
                                                jQuery("input#minCostPrice").val(value1);
                                            }
                                            jQuery("#sliderPrice").slider("values", 0, value1);
                                            if (parseFloat(jQuery("input#minCostPrice").val()) == parseFloat(<?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>) && parseFloat(jQuery("input#maxCostPrice").val()) == parseFloat(<?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>)) {
                                                jQuery("input#rangeChangePrice").val(0);
                                            } else {
                                                jQuery("input#rangeChangePrice").val(1);
                                            }
                                            jQuery("#categoryFilters").submit();
                                        });


                                        jQuery("input#maxCostPrice").change(function () {
                                            var value1 = jQuery("input#minCostPrice").val();
                                            var value2 = jQuery("input#maxCostPrice").val();

                                            if (parseFloat(value2) > parseFloat(<?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>)) {
                                                value2 = <?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>;
                                                jQuery("input#maxCostPrice").val(<?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>)
                                            }

                                            if (parseFloat(value1) > parseFloat(value2)) {
                                                value2 = value1;
                                                jQuery("input#maxCostPrice").val(value2);
                                            }
                                            jQuery("#sliderPrice").slider("values", 1, value2);
                                            if (parseFloat(jQuery("input#minCostPrice").val()) == parseFloat(<?= $price['from'] != "" ? $price['from'] : get_slot('filtersCategory')['minPrice'] ?>) && parseFloat(jQuery("input#maxCostPrice").val()) == parseFloat(<?= $price['to'] != "" ? $price['to'] : get_slot('filtersCategory')['maxPrice'] ?>)) {
                                                jQuery("input#rangeChangePrice").val(0);
                                            } else {
                                                jQuery("input#rangeChangePrice").val(1);
                                            }
                                            jQuery("#categoryFilters").submit();
                                        });

                                        jQuery("input#minCostPrice").keypress(function (event) {
                                            var key, keyChar;
                                            if (!event)
                                                var event = window.event;

                                            if (event.keyCode)
                                                key = event.keyCode;
                                            else if (event.which)
                                                key = event.which;

                                            if (key == null || key == 0 || key == 8 || key == 13 || key == 9 || key == 46 || key == 37 || key == 39)
                                                return true;
                                            keyChar = String.fromCharCode(key);

                                            if (!/\d/.test(keyChar))
                                                return false;

                                        });

                                        jQuery("input#maxCostPrice").keypress(function (event) {
                                            var key, keyChar;
                                            if (!event)
                                                var event = window.event;

                                            if (event.keyCode)
                                                key = event.keyCode;
                                            else if (event.which)
                                                key = event.which;

                                            if (key == null || key == 0 || key == 8 || key == 13 || key == 9 || key == 46 || key == 37 || key == 39)
                                                return true;
                                            keyChar = String.fromCharCode(key);

                                            if (!/\d/.test(keyChar))
                                                return false;

                                        });

                                    </script>
                                </div>
                            </div>
                        </li>
                        <?php
                        if (is_array($filtersDB))
                            foreach ($filtersDB as $diId => $filter) :
                                ?><li>
                                    <?php
                                    if (@is_array($filter['range'])) {
                                        ?>
                                        <div class="paramFilter">
                                            <div class="headerFilter" onclick="$('#paramsForHide<?= $diId ?>').toggle();
                                                                    if ($(this).children('img.imgButtonToggle').attr('src') == '/images/filters/silver-str-bottom.png') {
                                                                        $(this).children('img.imgButtonToggle').attr('src', '/images/filters/red-str-right.png');
                                                                    } else {
                                                                        $(this).children('img.imgButtonToggle').attr('src', '/images/filters/silver-str-bottom.png');
                                                                    }"><?= $filter['nameCategory'] ?> <img src="/images/filters/silver-str-bottom.png" class="imgButtonToggle" alt="Сбросить" style="position: absolute; right: 10px; top: 10px;"></div>
                                            <div class="value" id="paramsForHide<?= $diId ?>">
                                                от <input type="text" class="textParam" id="minCost<?= $diId ?>" value="<?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>" name="filters[<?= $diId ?>][from]" data-value="<?= $filter['range']['min'] ?>"/>
                                                до <input type="text" class="textParam" id="maxCost<?= $diId ?>"  value="<?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>" name="filters[<?= $diId ?>][to]" data-value="<?= $filter['range']['max'] ?>" /> <?= (preg_replace("/[^a-zA-ZА-Яа-я\s]/u", "", array_shift($filter)['value'])) ?>

                                                <div id="slider<?= $diId ?>" class="filter-slider"></div>
                                                <script type="text/javascript">


                                                    //
                                                    // Создание слайдера
                                                    //
                                                    jQuery("#slider<?= $diId ?>").slider({
                                                        min: <?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>,
                                                        animate: true,
                                                        max: <?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>,
                                                        step: 0.1,
                                                        values: [<?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>, <?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>],
                                                        range: true,
                                                        stop: function (event, ui) {
                                                            jQuery("input#minCost<?= $diId ?>").val(jQuery("#slider<?= $diId ?>").slider("values", 0));
                                                            jQuery("input#maxCost<?= $diId ?>").val(jQuery("#slider<?= $diId ?>").slider("values", 1));
                                                            if (parseFloat(jQuery("input#minCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>) && parseFloat(jQuery("input#maxCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>)) {
                                                                jQuery("input#rangeChange<?= $diId ?>").val(0);
                                                                $("#clearparams<?= $diId ?>").fadeOut();
                                                            } else {
                                                                jQuery("input#rangeChange<?= $diId ?>").val(1);
                                                                $("#clearparams<?= $diId ?>").fadeIn();

                                                            }
                                                            jQuery("#categoryFilters").submit();
                                                        },
                                                        slide: function (event, ui) {
                                                            jQuery("input#minCost<?= $diId ?>").val(jQuery("#slider<?= $diId ?>").slider("values", 0));
                                                            jQuery("input#maxCost<?= $diId ?>").val(jQuery("#slider<?= $diId ?>").slider("values", 1));
                                                            if (parseFloat(jQuery("input#minCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>) && parseFloat(jQuery("input#maxCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>)) {
                                                                jQuery("input#rangeChange<?= $diId ?>").val(0);
                                                                $("#clearparams<?= $diId ?>").fadeOut();
                                                            } else {
                                                                jQuery("input#rangeChange<?= $diId ?>").val(1);
                                                                $("#clearparams<?= $diId ?>").fadeIn();
                                                            }

                                                        }

                                                    });


                                                    //
                                                    // Изменение в форме
                                                    //
                                                    jQuery("input#minCost<?= $diId ?>").change(function () {
                                                        var value1 = jQuery("input#minCost<?= $diId ?>").val();
                                                        var value2 = jQuery("input#maxCost<?= $diId ?>").val();

                                                        if (parseFloat(value1) > parseFloat(value2)) {
                                                            value1 = value2;
                                                            jQuery("input#minCost<?= $diId ?>").val(value1);
                                                        }
                                                        if (parseFloat(value1) < parseFloat(<?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>)) {
                                                            value1 = <?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>;
                                                            jQuery("input#minCost<?= $diId ?>").val(value1);
                                                        }
                                                        jQuery("#slider<?= $diId ?>").slider("values", 0, value1);
                                                        if (parseFloat(jQuery("input#minCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>) && parseFloat(jQuery("input#maxCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>)) {
                                                            jQuery("input#rangeChange<?= $diId ?>").val(0);
                                                            $("#clearparams<?= $diId ?>").fadeOut();
                                                        } else {
                                                            jQuery("input#rangeChange<?= $diId ?>").val(1);
                                                            $("#clearparams<?= $diId ?>").fadeIn();
                                                        }
                                                        jQuery("#categoryFilters").submit();
                                                    });


                                                    jQuery("input#maxCost<?= $diId ?>").change(function () {
                                                        var value1 = jQuery("input#minCost<?= $diId ?>").val();
                                                        var value2 = jQuery("input#maxCost<?= $diId ?>").val();

                                                        if (parseFloat(value2) > parseFloat(<?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>)) {
                                                            value2 = <?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>;
                                                            jQuery("input#maxCost<?= $diId ?>").val(<?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>)
                                                        }

                                                        if (parseFloat(value1) > parseFloat(value2)) {
                                                            value2 = value1;
                                                            jQuery("input#maxCost<?= $diId ?>").val(value2);
                                                        }
                                                        jQuery("#slider<?= $diId ?>").slider("values", 1, value2);
                                                        if (parseFloat(jQuery("input#minCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['from'] != "" ? $filters[$diId]['from'] : $filter['range']['min'] ?>) && parseFloat(jQuery("input#maxCost<?= $diId ?>").val()) == parseFloat(<?= $filters[$diId]['to'] != "" ? $filters[$diId]['to'] : $filter['range']['max'] ?>)) {
                                                            jQuery("input#rangeChange<?= $diId ?>").val(0);
                                                            $("#clearparams<?= $diId ?>").fadeOut();
                                                        } else {
                                                            jQuery("input#rangeChange<?= $diId ?>").val(1);
                                                            $("#clearparams<?= $diId ?>").fadeIn();
                                                        }
                                                        jQuery("#categoryFilters").submit();
                                                    });


                                                    //
                                                    // Проверка формы
                                                    //
                                                    jQuery("input#minCost<?= $diId ?>").keypress(function (event) {
                                                        var key, keyChar;
                                                        if (!event)
                                                            var event = window.event;

                                                        if (event.keyCode)
                                                            key = event.keyCode;
                                                        else if (event.which)
                                                            key = event.which;

                                                        if (key == null || key == 0 || key == 8 || key == 13 || key == 9 || key == 46 || key == 37 || key == 39)
                                                            return true;
                                                        keyChar = String.fromCharCode(key);

                                                        if (!/\d/.test(keyChar))
                                                            return false;

                                                    });

                                                    jQuery("input#maxCost<?= $diId ?>").keypress(function (event) {
                                                        var key, keyChar;
                                                        if (!event)
                                                            var event = window.event;

                                                        if (event.keyCode)
                                                            key = event.keyCode;
                                                        else if (event.which)
                                                            key = event.which;

                                                        if (key == null || key == 0 || key == 8 || key == 13 || key == 9 || key == 46 || key == 37 || key == 39)
                                                            return true;
                                                        keyChar = String.fromCharCode(key);

                                                        if (!/\d/.test(keyChar))
                                                            return false;

                                                    });

                                                </script>
                                            </div>
                                        </div>
                                        <?php
                                    } else {
                                        ?>
                                        <div class="paramFilter">
                                            <? if (@count($_GET['filters'][$diId]) > 0) { ?>
                                                <div class="headerFilter" onclick="$('#paramsForHide<?= $diId ?>').toggle();
                                                                            if ($(this).children('img.imgButtonToggle').attr('src') == '/images/filters/silver-str-bottom.png') {
                                                                                $(this).children('img.imgButtonToggle').attr('src', '/images/filters/red-str-right.png');
                                                                            } else {
                                                                                $(this).children('img.imgButtonToggle').attr('src', '/images/filters/silver-str-bottom.png');
                                                                            }"><?= $filter['nameCategory'] ?> <img src="/images/filters/silver-str-bottom.png" class="imgButtonToggle" alt="Сбросить" style="position: absolute; right: 10px; top: 10px;"></div>
                                                 <? } else { ?>
                                                <div class="headerFilter" onclick="$('#paramsForHide<?= $diId ?>').toggle();
                                                                            if ($(this).children('img.imgButtonToggle').attr('src') == '/images/filters/silver-str-bottom.png') {
                                                                                $(this).children('img.imgButtonToggle').attr('src', '/images/filters/red-str-right.png');
                                                                            } else {
                                                                                $(this).children('img.imgButtonToggle').attr('src', '/images/filters/silver-str-bottom.png');
                                                                            }"><?= $filter['nameCategory'] ?> <img src="/images/filters/red-str-right.png" class="imgButtonToggle" alt="Сбросить" style="position: absolute; right: 10px; top: 10px;"></div>

                                            <? } ?>
                                        </div>
                                        <div class="valueParams" <? if (@count($_GET['filters'][$diId]) == 0) { ?>style="display: none;"<? } ?> id="paramsForHide<?= $diId ?>">
                                            <?php
                                            if (is_array($filter))
                                                foreach ($filter as $paramKey => $filterParam) {
                                                    if ($paramKey !== "nameCategory") {
                                                        $checked = "";
                                                        if (@is_array($filters[$diId])) {
                                                            if (array_search($paramKey, $filters[$diId]) !== false) {
                                                                $checked = "checked=\"checked\"";
                                                                $imgClass = "class=\"colorFilterButton-select\"";
                                                            } else {
                                                                $imgClass = "class=\"colorFilterButton\"";
                                                            }
                                                        } else {
                                                            $imgClass = "class=\"colorFilterButton\"";
                                                        }
                                                        if (isset($filterParam['filename'])) {
                                                            echo '<div style="display: inline-block;margin: 5px;"><input type="checkbox" ' . $checked . ' onClick="jQuery(\'#categoryFilters\').submit();" name="filters[' . $diId . '][]" value="' . $paramKey . '" class="filteParams" style="opacity:0; position:absolute; left:9999px;"><img src="/uploads/dopinfo/thumbnails/' . $filterParam['filename'] . '" alt="' . $filterParam['value'] . '" title="' . $filterParam['value'] . '" ' . $imgClass . ' width="28" onClick=" if ( $(this).hasClass(\'colorFilterButton\') ) {$(this).removeClass(\'colorFilterButton\').addClass(\'colorFilterButton-select\');$(this).prev(\'input\').attr(\'checked\', \'checked\');}else{$(this).removeClass(\'colorFilterButton-select\').addClass(\'colorFilterButton\');$(this).prev(\'input\').removeAttr(\'checked\');} jQuery(\'#categoryFilters\').submit();" style="cursor: pointer;"></div>';
                                                        } else {
                                                            echo '<div><input type="checkbox" ' . $checked . ' onClick="jQuery(\'#categoryFilters\').submit();" name="filters[' . $diId . '][]" value="' . $paramKey . '" class="filteParams"><div style="display: inline;"> - ' . $filterParam['value'] . ' (<div style="display: inline;" class="countProd" data-default="' . $filterParam['countProducts'] . '">' . (@is_array($filtersCountProducts) ? (@$filtersCountProducts[$paramKey]['count'] != "" ? @$filtersCountProducts[$paramKey]['count'] : '0') : $filterParam['countProducts']) . '</div>)</div></div>';
                                                        }
                                                    }
                                                }
                                            ?> </div>
                                        <?php
                                    }
                                    ?>
                                </li>
                                <?php
                            endforeach;
                        ?>
                    </ul>


                </form>


                <?php
                JSInPages("
                function clearFilters(){
                document.location.href = '" . explode("?", $_SERVER['REQUEST_URI'])[0] . "';

                }
                ");
                ?>
                <div class="paramFilter" style="cursor: pointer;">
                    <div id="clearFilters" class="headerFilter" onClick="clearFilters()">
                        <div class="text" style="text-align: center;">
                            <b>Очистить все фильтры</b>
                        </div>
                    </div>
                </div>
            </div>
        <? } ?>
